import streamlit as st
import pandas as pd

st.set_page_config(page_title="ãƒ—ãƒ­ç«¶é¦¬åˆ†æã‚·ã‚¹ãƒ†ãƒ ãƒ»ç©¶æ¥µç‰ˆ", layout="wide")

# --- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (é ‚ã„ãŸå…¨æ•°å€¤ã‚’100%åæ˜ ) ---
data_db = {
    "ï¼¡": {
        "â‘¢": {"win":"7/17","u5":"11/17","f_a":"15/23","f_b":"12/23","f_c":"11/23","abc_w":"9/17(3)","pop":[15,16,5,11,5,5,3,5,0,1,0,0,0],"idx":["8/20","13","3","4"]},
        "â‘£": {"win":"6/20","u5":"12/20","f_a":"9/21","f_b":"9/21","f_c":"7/21","abc_w":"7/20","pop":[10,12,8,5,4,6,5,2,4,3,1,0,0],"idx":["9/20","7","10","6"]},
        "â‘¤": {"win":"3/9","u5":"8/9","f_a":"4/12","f_b":"4/12","f_c":"6/12","abc_w":"5/9","pop":[6,10,5,4,3,1,2,2,2,0,0,0,0],"idx":["3/9","3","3","2"]}
    },
    "ï¼¢": {
        "â‘¢": {"win":"3/6","u5":"5/6","f_a":"4/8","f_b":"4/8","f_c":"3/8","abc_w":"2/6","pop":[6,2,4,2,3,1,3,1,0,0,0,0,0],"idx":["6/8","5","1","2"]},
        "â‘£": {"win":"10/19","u5":"9/19","f_a":"8/20","f_b":"12/20","f_c":"4/20","abc_w":"7/19","pop":[11,12,7,4,1,5,6,1,3,1,4,2,0],"idx":["9/16","8","3","4"]},
        "â‘¤": {"win":"4/13","u5":"7/13","f_a":"9/15","f_b":"10/15","f_c":"7/15","abc_w":"7/13(2)","pop":[10,11,3,6,5,3,0,4,1,0,0,0,1],"idx":["6/12","2","4","3"]}
    },
    "ï¼£": {
        "â‘¢": {"win":"6/9","u5":"6/9","f_a":"8/10","f_b":"5/10","f_c":"6/10","abc_w":"7/9(1)","pop":[9,6,5,3,1,1,1,1,1,1,0,0,0],"idx":["2/5","2","2","3"]},
        "â‘£": {"win":"3/7","u5":"4/7","f_a":"5/11","f_b":"5/11","f_c":"3/11","abc_w":"3/7","pop":[6,4,2,8,3,1,2,2,2,0,1,1,0],"idx":["2/10","4","4","5"]},
        "â‘¤": {"win":"4/6","u5":"4/6","f_a":"4/8","f_b":"3/8","f_c":"5/8","abc_w":"2/6","pop":[3,2,5,1,5,1,2,1,1,1,0,1,0],"idx":["3/7","3","1","1"]}
    },
    "ï¼¡ï¼¢": {
        "â‘¢": {"win":"9/13","u5":"12/13","f_a":"14/17","f_b":"11/17","f_c":"7/17","abc_w":"10/13(1)","pop":[13,13,7,5,3,4,0,1,1,2,1,0,0],"idx":["13/14","6","2","2"]},
        "â‘£": {"win":"3/5","u5":"6/11","f_a":"5/12","f_b":"7/12","f_c":"6/12","abc_w":"6/11","pop":[7,8,3,4,5,4,2,1,0,1,1,0,0],"idx":["5/12","4","5","3"]},
        "â‘¤": {"win":"1/3","u5":"4/4","f_a":"3/4","f_b":"3/4","f_c":"0/4","abc_w":"2/4","pop":[3,1,4,1,2,0,0,0,0,0,0,0,0],"idx":["2/4","3","0","0"]}
    },
    "ãƒãƒ¼ãƒãƒ¼ã‚¯": {
        "â‘¢": {"win":"10/27","u5":"12/27","f_a":"5/7","f_b":"4/7","f_c":"3/7","abc_w":"3/8","pop":[6,6,4,2,1,2,2,0,3,1,0,0,0],"idx":["4/8","2","2","1"]},
        "â‘£": {"win":"11/19","u5":"10/19","f_a":"8/16","f_b":"9/16","f_c":"1/16","abc_w":"4/8","pop":[11,10,4,4,4,4,8,3,1,2,0,1,2],"idx":["2/8","3","2","4"]},
        "â‘¤": {"win":"9/18","u5":"8/18","f_a":"7/11","f_b":"2/11","f_c":"3/11","abc_w":"3/10","pop":[9,8,7,7,6,3,4,3,1,3,1,0,0],"idx":["2/10","3","4","3"]}
    }
}

def pct(frac):
    try:
        f = frac.split('(')[0]
        if '/' not in f: return "---"
        n, den = map(int, f.split('/'))
        return f"{(n/den)*100:.1f}%"
    except: return "---"

st.title("ğŸ‡ ç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯ãƒ»çš„ä¸­æ•°æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ")

# 1. ãƒ¬ãƒ¼ã‚¹å
st.text_input("ğŸ“ ãƒ¬ãƒ¼ã‚¹åã‚’å…¥åŠ›", "ä¸­å±±â—¯ãƒ¬ãƒ¼ã‚¹")

# 2. ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ãƒ¬ãƒ™ãƒ«é¸æŠ
st.subheader("ğŸ ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠ")
c_patt, c_lv = st.columns(2)
target = c_patt.selectbox("ãƒ‘ã‚¿ãƒ¼ãƒ³", ["ï¼¡", "ï¼¢", "ï¼£", "ï¼¡ï¼¢", "ï¼¡ï¼£", "ï¼¢ï¼£", "ï¼¡ï¼¢ï¼£", "ãƒãƒ¼ãƒãƒ¼ã‚¯"])
lv = c_lv.radio("ãƒ¬ãƒ™ãƒ«", ["â‘¢", "â‘£", "â‘¤"], horizontal=True)
d = data_db.get(target, data_db["ï¼¡"]).get(lv, data_db["ï¼¡"]["â‘¢"])

st.divider()

# 3. ABCé¦¬ç•ªå…¥åŠ› & å€‹åˆ¥è¤‡å‹ç‡
st.subheader("ğŸ´ è»¸é¦¬å…¥åŠ›ã¨ã€ï¼¡ãƒ»ï¼¢ãƒ»ï¼£å€‹åˆ¥è¤‡å‹ç‡ã€‘")
ca, cb, cc = st.columns(3)
ca.metric("ï¼¡é¦¬ è¤‡å‹ç‡", f"{pct(d['f_a'])}", d['f_a'])
ca.text_input("ï¼¡é¦¬ç•ªã‚’è¨˜å…¥", key="a_n")
cb.metric("ï¼¢é¦¬ è¤‡å‹ç‡", f"{pct(d['f_b'])}", d['f_b'])
cb.text_input("ï¼¢é¦¬ç•ªã‚’è¨˜å…¥", key="b_n")
cc.metric("ï¼£é¦¬ è¤‡å‹ç‡", f"{pct(d['f_c'])}", d['f_c'])
cc.text_input("ï¼£é¦¬ç•ªã‚’è¨˜å…¥", key="c_n")

# 4. ç‹¬è‡ªæŒ‡æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°
st.subheader("ğŸ¯ ç‹¬è‡ªæŒ‡æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚° (ã‚¿ã‚¤å«ã‚€)")
idx_cols = st.columns(4)
for i in range(4):
    idx_cols[i].text_input(f"æŒ‡æ•°{i+1}ä½ (çš„ä¸­:{d['idx'][i]})", key=f"idx_{i}")

# 5. ç‰¹æ®Šé¦¬å…¥åŠ›
st.subheader("ğŸ“‹ ç‰¹æ®Šå…¥åŠ›")
s_c1, s_c2, s_c3 = st.columns(3)
s_c1.text_input("ï¼°", key="p_m")
s_c2.text_input("ï¼´", key="t_m")
s_c3.text_input("ï¼°ï¼´", key="pt_m")
s_c4, s_c5 = st.columns(2)
s_c4.text_input("æ˜‡ç´šé¦¬", key="up_m")
s_c5.text_input("èª¿æ•™", key="tr_m")

st.divider()

# 6. äººæ°—åˆ¥å…¥åŠ›
st.subheader("ğŸ“Š äººæ°—åˆ¥ã®é¦¬ç•ªå…¥åŠ›")
pop_list = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
for p in pop_list:
    hits = d["pop"][p-1] if p-1 < len(d["pop"]) else 0
    cl, ci = st.columns([1, 4])
    cl.write(f"**{p}**ç•ªäººæ°—")
    ci.text_input(f"é¦¬ç•ªã‚’å…¥åŠ› (éå»çš„ä¸­: {hits}å›)", key=f"p_in_{p}")

st.write("--- 10ç•ªäººæ°—ä»¥ä¸‹ ---")
for i in range(1, 4):
    clx, cix = st.columns([1, 4])
    clx.write(f"**è¿½åŠ {i}**")
    cix.text_input("é¦¬ç•ªã‚’å…¥åŠ›", key=f"extra_{i}")

st.divider()

# 7. å…¨ä½“ã¾ã¨ã‚
st.header("ğŸ“ˆ çš„ä¸­æœŸå¾…å€¤ã‚µãƒãƒªãƒ¼")
res_c = st.columns(3)
res_c[0].metric("è»¸1ç€ç‡", pct(d["win"]), d["win"])
res_c[1].metric("é¦¬é€£5å†…", pct(d["u5"]), d["u5"])
res_c[2].metric("ABCãƒ¯ã‚¤ãƒ‰", pct(d["abc_w"]), d["abc_w"])
