import streamlit as st
import pandas as pd

st.set_page_config(page_title="ãƒ—ãƒ­ç«¶é¦¬åˆ†æã‚·ã‚¹ãƒ†ãƒ ãƒ»å®Œå…¨ç‰ˆ", layout="wide")

# --- é ‚ã„ãŸå…¨ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ ã•ã›ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ---
data_db = {
    "ï¼¡": {
        "â‘¢": {"win":"7/17","uren5":"11/17","f_a":"15/23","f_b":"12","f_c":"11","abc_w":"9/17(3)","pop":[15,16,5,11,5,5,3,5,0,1,0,0,0],"idx":["8/20","13","3","4"]},
        "â‘£": {"win":"6/20","uren5":"12/20","f_a":"9/21","f_b":"9","f_c":"7","abc_w":"7/20","pop":[10,12,8,5,4,6,5,2,4,3,1,0,0],"idx":["9/20","7","10","6"]},
        "â‘¤": {"win":"3/9","uren5":"8/9","f_a":"4/12","f_b":"4","f_c":"6","abc_w":"5/9","pop":[6,10,5,4,3,1,2,2,2,0,0,0,0],"idx":["3/9","3","3","2"]}
    },
    "ï¼¢": {
        "â‘¢": {"win":"3/6","uren5":"5/6","f_a":"4/8","f_b":"4","f_c":"3","abc_w":"2/6","pop":[6,2,4,2,3,1,3,1,0,0,0,0,0],"idx":["6/8","5","1","2"]},
        "â‘£": {"win":"10/19","uren5":"9/19","f_a":"8/20","f_b":"12","f_c":"4","abc_w":"7/19","pop":[11,12,7,4,1,5,6,1,3,1,4,2,0],"idx":["9/16","8","3","4"]},
        "â‘¤": {"win":"4/13","uren5":"7/13","f_a":"9/15","f_b":"10","f_c":"7","abc_w":"7/13(2)","pop":[10,11,3,6,5,3,0,4,1,0,0,0,1],"idx":["6/12","2","4","3"]}
    },
    "ï¼£": {
        "â‘¢": {"win":"6/9","uren5":"6/9","f_a":"8/10","f_b":"5","f_c":"6","abc_w":"7/9(1)","pop":[9,6,5,3,1,1,1,1,1,1,0,0,0],"idx":["2/5","2","2","3"]},
        "â‘£": {"win":"3/7","uren5":"4/7","f_a":"5/11","f_b":"5","f_c":"3","abc_w":"3/7","pop":[6,4,2,8,3,1,2,2,2,0,1,1,0],"idx":["2/10","4","4","5"]},
        "â‘¤": {"win":"4/6","uren5":"4/6","f_a":"4/8","f_b":"3","f_c":"5","abc_w":"2/6","pop":[3,2,5,1,5,1,2,1,1,1,0,1,0],"idx":["3/7","3","1","1"]}
    },
    "ï¼¡ï¼¢": {
        "â‘¢": {"win":"9/13","uren5":"12/13","f_a":"14/17","f_b":"11","f_c":"7","abc_w":"10/13(1)","pop":[13,13,7,5,3,4,0,1,1,2,1,0,0],"idx":["13/14","6","2","2"]},
        "â‘£": {"win":"3/5","uren5":"6/11","f_a":"5/12","f_b":"7","f_c":"6","abc_w":"6/11","pop":[7,8,3,4,5,4,2,1,0,1,1,0,0],"idx":["5/12","4","5","3"]},
        "â‘¤": {"win":"1/3","uren5":"4/4","f_a":"3/4","f_b":"3","f_c":"0","abc_w":"2/4","pop":[3,1,4,1,2,0,0,0,0,0,0,0,0],"idx":["2/4","3","0","0"]}
    },
    "ï¼¡ï¼£": {
        "â‘¢": {"win":"4/13","uren5":"2/5","f_a":"5/8","f_b":"4","f_c":"5","abc_w":"2/5","pop":[6,4,3,2,3,2,1,0,2,0,0,0,0],"idx":["12/8","0","0","2"]},
        "â‘£": {"win":"3/5","uren5":"7/7","f_a":"5/8","f_b":"3","f_c":"4","abc_w":"5/7","pop":[6,3,6,3,2,3,0,0,0,0,0,0,1],"idx":["5/6","2","3","1"]},
        "â‘¤": {"win":"5/7","uren5":"0/1","f_a":"1/1","f_b":"0","f_c":"0","abc_w":"0/1","pop":[1,0,0,1,0,0,1,0,0,0,0,0,0],"idx":["0/1","2","0","0"]}
    },
    "ï¼¢ï¼£": {
        "â‘¢": {"win":"1/3","uren5":"2/3","f_a":"4/5","f_b":"3","f_c":"1","abc_w":"2/3","pop":[5,3,2,0,2,0,1,0,2,0,0,0,0],"idx":["4/5","2","2","3"]},
        "â‘£": {"win":"2/5","uren5":"1/5","f_a":"1/5","f_b":"3","f_c":"0","abc_w":"0/5","pop":[2,3,2,2,1,2,0,1,0,0,0,1,0],"idx":["1/5","3","2","2"]},
        "â‘¤": {"win":"2/5","uren5":"4/5","f_a":"5/6","f_b":"3","f_c":"1","abc_w":"2/5","pop":[5,3,3,1,1,0,0,2,0,0,1,0,0],"idx":["3/6","3","3","0"]}
    },
    "ãƒãƒ¼ãƒãƒ¼ã‚¯": {
        "â‘¢": {"win":"10/27","uren5":"12/27","f_a":"5/7","f_b":"4","f_c":"3","abc_w":"3/8","pop":[6,6,4,2,1,2,2,0,3,1,0,0,0],"idx":["4/8","2","2","1"]},
        "â‘£": {"win":"11/19","uren5":"10/19","f_a":"8/16","f_b":"9","f_c":"1","abc_w":"4/8","pop":[11,10,4,4,4,4,8,3,1,2,0,1,2],"idx":["2/8","3","2","4"]},
        "â‘¤": {"win":"9/18","uren5":"8/18","f_a":"7/11","f_b":"2","f_c":"3","abc_w":"3/10","pop":[9,8,7,7,6,3,4,3,1,3,1,0,0],"idx":["2/10","3","4","3"]}
    }
}

def pct(frac):
    try:
        f = frac.split('(')[0]
        if '/' not in f: return "---"
        n, den = map(int, f.split('/'))
        return f"{(n/den)*100:.1f}%"
    except: return "---"

st.title("ğŸ‡ ç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯åˆ†æãƒ»ç©¶æ¥µäºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ ")

# 1. ãƒ¬ãƒ¼ã‚¹å
st.text_input("ğŸ“ ãƒ¬ãƒ¼ã‚¹åã‚’å…¥åŠ›", "ä¸­å±±â—¯ãƒ¬ãƒ¼ã‚¹")

# 2. æ¡ä»¶é¸æŠ (ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ¬ãƒ™ãƒ«)
st.subheader("ğŸ æ¡ä»¶é¸æŠ")
c_patt, c_lv = st.columns(2)
target = c_patt.selectbox("ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠ", ["ï¼¡", "ï¼¢", "ï¼£", "ï¼¡ï¼¢", "ï¼¡ï¼£", "ï¼¢ï¼£", "ï¼¡ï¼¢ï¼£", "ãƒãƒ¼ãƒãƒ¼ã‚¯"])
lv = c_lv.radio("ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠ", ["â‘¢", "â‘£", "â‘¤"], horizontal=True)
d = data_db.get(target, data_db["ï¼¡"]).get(lv, data_db["ï¼¡"]["â‘¢"])

st.divider()

# 3. è»¸é¦¬å…¥åŠ›
st.subheader("ğŸ´ è»¸é¦¬å…¥åŠ› (ã‚«ãƒƒã‚³å†…ã¯éå»ã®çš„ä¸­å®Ÿç¸¾)")
ca, cb, cc = st.columns(3)
ca.text_input(f"ï¼¡é¦¬ç•ª (å®Ÿç¸¾:{d['f_a']})", key="a_n")
cb.text_input(f"ï¼¢é¦¬ç•ª (å®Ÿç¸¾:{d['f_b']})", key="b_n")
cc.text_input(f"ï¼£é¦¬ç•ª (å®Ÿç¸¾:{d['f_c']})", key="c_n")

# 4. ç‹¬è‡ªæŒ‡æ•°
st.subheader("ğŸ¯ ç‹¬è‡ªæŒ‡æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°")
idx_cols = st.columns(4)
for i in range(4):
    idx_cols[i].text_input(f"{i+1}ä½ é¦¬ç•ª (çš„ä¸­:{d['idx'][i]})", key=f"idx{i}")

# 5. ç‰¹æ®Šé¦¬
st.subheader("ğŸ“‹ ç‰¹æ®Šé¦¬å…¥åŠ›")
s1, s2, s3, s4, s5 = st.columns(5)
s1.text_input("ï¼°", key="p_m")
s2.text_input("ï¼´", key="t_m")
s3.text_input("ï¼°ï¼´", key="pt_m")
s4.text_input("æ˜‡ç´š", key="up_m")
s5.text_input("èª¿æ•™", key="tr_m")

st.divider()

# 6. äººæ°—åˆ¥å…¥åŠ› (æ¨ªã«é¦¬ç•ª)
st.subheader("ğŸ“Š äººæ°—åˆ¥ã®é¦¬ç•ªå…¥åŠ›")
pop_order = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
for p in pop_order:
    hits = d["pop"][p-1] if p-1 < len(d["pop"]) else 0
    col_l, col_i = st.columns([1, 4])
    col_l.write(f"**{p}**ç•ªäººæ°—")
    col_i.text_input(f"é¦¬ç•ªã‚’å…¥åŠ› (éå»çš„ä¸­: {hits}å›)", key=f"p_in_{p}")

st.write("--- 10ç•ªäººæ°—ä»¥ä¸‹ ---")
for i in range(1, 4):
    clx, cix = st.columns([1, 4])
    clx.write(f"**è¿½åŠ {i}**")
    cix.text_input("é¦¬ç•ªã‚’å…¥åŠ›", key=f"extra_{i}")

st.divider()

# 7. çš„ä¸­æœŸå¾…å€¤ã¾ã¨ã‚ (ï¼…ã¨åˆ†æ•°ã‚’ä¸¡æ–¹è¡¨ç¤º)
st.header("ğŸ“ˆ çš„ä¸­æœŸå¾…å€¤ã‚µãƒãƒªãƒ¼")
res_c = st.columns(4)
res_c[0].metric("è»¸é¦¬1ç€ç‡", f"{pct(d['win'])}", d['win'])
res_c[1].metric("é¦¬é€£5äººå†…", f"{pct(d['uren5'])}", d['uren5'])
res_c[2].metric("è¤‡å‹ç‡(A)", f"{pct(d['f_a'])}", d['f_a'])
res_c[3].metric("ABCãƒ¯ã‚¤ãƒ‰", f"{pct(d['abc_w'])}", d['abc_w'])
