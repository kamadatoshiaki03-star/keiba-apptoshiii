import streamlit as st
import pandas as pd

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="ãƒ—ãƒ­ç«¶é¦¬äºˆæƒ³è¨ˆç®—æ©Ÿ", layout="wide")
st.title("ğŸ‡ ç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯ãƒ»å…¨çµ±è¨ˆ çš„ä¸­æœŸå¾…å€¤ äºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ ")

# --- ã‚ãªãŸã®å…¨çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆé ‚ã„ãŸæ•°å€¤ã‚’å…¨ã¦åæ˜ ï¼‰ ---
data_db = {
    "ï¼¡": {
        "â‘¢": {"win": "7/17", "uren5": "11/17", "fuku": "15/23", "abc_w": "9/17(3)", "pop": [15,16,5,11,5,5,3,5,0,1,1,1,0,1], "idx": ["8/20", "13", "3", "4"], "idx_w": "10(3)"},
        "â‘£": {"win": "6/20", "uren5": "12/20", "fuku": "9/21", "abc_w": "7/20", "pop": [10,12,8,5,4,6,5,2,4,3,1,0,0,1], "idx": ["9/20", "7", "10", "6"], "idx_w": "12(3)"},
        "â‘¤": {"win": "3/9", "uren5": "8/9", "fuku": "4/12", "abc_w": "5/9", "pop": [6,10,5,4,3,1,2,2], "idx": ["3/9", "3", "3", "2"], "idx_w": "3"}
    },
    "ï¼¢": {
        "â‘¢": {"win": "3/6", "uren5": "5/6", "fuku": "4/8", "abc_w": "2/6", "pop": [6,2,4,2,3,1,3,1], "idx": ["6/8", "5", "1", "2"], "idx_w": "6(1)"},
        "â‘£": {"win": "10/19", "uren5": "9/19", "fuku": "8/20", "abc_w": "7/19", "pop": [11,12,7,4,1,5,6,1,3,1,4,2], "idx": ["9/16", "8", "3", "4"], "idx_w": "8(2)"},
        "â‘¤": {"win": "4/13", "uren5": "7/13", "fuku": "9/15", "abc_w": "7/13(2)", "pop": [10,11,3,6,5,3,4,0,1,0,0,0,1], "idx": ["6/12", "2", "4", "3"], "idx_w": "5(1)"}
    },
    "ï¼£": {
        "â‘¢": {"win": "6/9", "uren5": "6/9", "fuku": "8/10", "abc_w": "7/9(1)", "pop": [9,6,5,3,1,1,1,1], "idx": ["2/5", "2", "2", "3"], "idx_w": "3(1)"},
        "â‘£": {"win": "3/7", "uren5": "4/7", "fuku": "5/11", "abc_w": "3/7", "pop": [6,4,2,8,3,1,2,2,2,0,1,1], "idx": ["2/10", "4", "4", "5"], "idx_w": "4(2)"},
        "â‘¤": {"win": "4/6", "uren5": "4/6", "fuku": "4/8", "abc_w": "2/6", "pop": [3,2,5,1,5,1,2,1], "idx": ["3/7", "3", "1", "1"], "idx_w": "2"}
    },
    "ï¼¡ï¼¢": {
        "â‘¢": {"win": "9/13", "uren5": "12/13", "fuku": "14/17", "abc_w": "10/13(1)", "pop": [13,13,7,5,3,4,0,1,1,2,1,0,0,0,1], "idx": ["13/14", "6", "2", "2"], "idx_w": "8(3)"},
        "â‘£": {"win": "3/5", "uren5": "6/11", "fuku": "5/12", "abc_w": "6/11", "pop": [7,8,3,4,5,4,2,1,0,1,1], "idx": ["5/12", "4", "5", "3"], "idx_w": "5(1)"},
        "â‘¤": {"win": "1/3", "uren5": "4/4", "fuku": "3/4", "abc_w": "2/4", "pop": [3,1,4,1,2], "idx": ["2/4", "3", "0", "0"], "idx_w": "2(1)"}
    },
    "ï¼¡ï¼¢ï¼£": {
        "â‘¢": {"win": "64/86", "uren5": "56/86", "fuku": "47/86", "abc_w": "5476äººæ°—(98)", "pop": [0,0,0,0,0,0,0,0], "idx": ["3/8", "4", "4", "1"], "idx_w": "4"},
        "â‘£": {"win": "0/0", "uren5": "0/0", "fuku": "0/0", "abc_w": "0/0", "pop": [0,0,0,0,0,0,0,0], "idx": ["0/0", "0", "0", "0"], "idx_w": "0"},
        "â‘¤": {"win": "0/0", "uren5": "0/0", "fuku": "0/0", "abc_w": "0/0", "pop": [0,0,0,0,0,0,0,0], "idx": ["0/0", "0", "0", "0"], "idx_w": "0"}
    },
    "ãƒãƒ¼ãƒãƒ¼ã‚¯": {
        "â‘¢": {"win": "10/27", "uren5": "12/27", "fuku": "7/27", "abc_w": "3/8", "pop": [6,6,4,2,1,2,2,0,3,1,1,0,1], "idx": ["4/8", "2", "2", "1"], "idx_w": "3"},
        "â‘£": {"win": "11/19", "uren5": "10/19", "fuku": "4/19", "abc_w": "4/8", "pop": [11,10,4,4,4,4,8,3,1,2,0,1,2,2], "idx": ["2/8", "3", "2", "4"], "idx_w": "4"},
        "â‘¤": {"win": "9/18", "uren5": "8/18", "fuku": "7/18", "abc_w": "3/10", "pop": [9,8,7,7,6,3,4,3,1,3,1,0,0,1], "idx": ["2/10", "3", "4", "3"], "idx_w": "3"}
    }
}

# å…±é€šãƒ‡ãƒ¼ã‚¿ (PT/ç‹¬è‡ªæŒ‡æ•°ç·è¨ˆ)
pt_p = {"ï¼¡": "20/33", "ï¼¢": "19/25", "ï¼£": "11/21", "ï¼¡ï¼¢": "21/27", "ï¼¡ï¼£": "11/14", "ï¼¢ï¼£": "8/15", "ï¼¡ï¼¢ï¼£": "7/6", "ãƒãƒ¼ãƒãƒ¼ã‚¯": "14/20"}
pt_t = {"ï¼¡": "18/27", "ï¼¢": "10/15", "ï¼£": "6/15", "ï¼¡ï¼¢": "18/23", "ï¼¡ï¼£": "8/9", "ï¼¢ï¼£": "6/11", "ï¼¡ï¼¢ï¼£": "5/8", "ãƒãƒ¼ãƒãƒ¼ã‚¯": "9/20"}
idx_w_tot = {"ï¼¡": "30", "ï¼¢": "17", "ï¼£": "7", "ï¼¡ï¼¢": "18", "ï¼¡ï¼£": "11", "ï¼¢ï¼£": "9", "ï¼¡ï¼¢ï¼£": "4", "ãƒãƒ¼ãƒãƒ¼ã‚¯": "14"}

# ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
st.sidebar.header("ğŸ“‹ ã€Step 1ã€‘ æ¡ä»¶é¸æŠ")
target = st.sidebar.selectbox("è»¸é¦¬ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ", list(data_db.keys()))
lv = st.sidebar.radio("ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠ", ["â‘¢", "â‘£", "â‘¤"])

# ä»Šæ—¥ã®æƒ…å ±ã®å…¥åŠ›ï¼ˆã“ã“ãŒã€Œäºˆæƒ³ã€ã®å…¥ã‚Šå£ã§ã™ï¼ï¼‰
st.subheader("ğŸ“ ã€Step 2ã€‘ ä»Šæ—¥ã®ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’å…¥åŠ›")
col_in1, col_in2, col_in3 = st.columns(3)
with col_in1: horse_pop = st.number_input("ä»Šæ—¥ã®é¦¬ã®äººæ°—(1ã€œ15)", 1, 15, 1)
with col_in2: idx_rank = st.number_input("ç‹¬è‡ªæŒ‡æ•°ã¯ä½•ä½ï¼Ÿ(1ã€œ4)", 1, 4, 1)
with col_in3: p_val = st.number_input("Pã®å€¤ã¯ï¼Ÿ", 1, 50, 5)

st.divider()

# --- åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ ---
d = data_db[target][lv]
pop_hits = d["pop"][horse_pop-1] if horse_pop <= len(d["pop"]) else 0
idx_hit_rate = d["idx"][idx_rank-1]

st.header(f"ğŸ“Š äºˆæƒ³ã®æ ¹æ‹ ï¼š{target} Ã— {lv}")
res_c1, res_c2 = st.columns(2)
with res_c1:
    st.info(f"**ã€çš„ä¸­æ ¹æ‹  1ï¼šäººæ°—ã€‘**\n\néå»ã« **{horse_pop}ç•ªäººæ°—** ãŒæ¥ãŸå›æ•°ï¼š\n\n## {pop_hits}å›")
with res_c2:
    st.success(f"**ã€çš„ä¸­æ ¹æ‹  2ï¼šç‹¬è‡ªæŒ‡æ•°ã€‘**\n\nç‹¬è‡ªæŒ‡æ•° **{idx_rank}ä½** ã®éå»çš„ä¸­å®Ÿç¸¾ï¼š\n\n## {idx_hit_rate}")

st.divider()

# ãã®ä»–ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
st.subheader("ğŸ“ˆ ã“ã®æ¡ä»¶ã®åŸºæœ¬çµ±è¨ˆ (ï¼…)")
def pct(frac):
    try:
        f = frac.split('(')[0]
        if '/' not in f: return f
        n, den = map(int, f.split('/'))
        return f"{(n/den)*100:.1f}%" if den != 0 else "0.0%"
    except: return "---"

c1, c2, c3, c4 = st.columns(4)
with c1: st.metric("è»¸1ç€ç¢ºç‡", pct(d["win"]), d["win"])
with c2: st.metric("é¦¬é€£5äººå†…", pct(d["uren5"]), d["uren5"])
with c3: st.metric("è¤‡å‹ç‡", pct(d["fuku"]), d["fuku"])
with c4: st.metric("ABCãƒ¯ã‚¤ãƒ‰", pct(d["abc_w"]), d["abc_w"])

st.divider()
st.subheader("ğŸ ç‹¬è‡ªæŒ‡æ•°ãƒ¯ã‚¤ãƒ‰ç¢ºç‡ãƒ»PTæŒ‡æ¨™")
st.write(f"ç‹¬è‡ªæŒ‡æ•°ãƒ¯ã‚¤ãƒ‰ç¢ºç‡: **{idx_w_tot.get(target)}** | PTæœ€è¿‘(P): **{pt_p.get(target)}** | PTæœ€è¿‘(T): **{pt_t.get(target)}**")
