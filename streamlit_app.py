import streamlit as st
import pandas as pd

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="ãƒ—ãƒ­ç«¶é¦¬åˆ†æãƒ»ç©¶æ¥µå®Œæˆç‰ˆ", layout="wide")
st.title("ğŸ‡ ç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯ãƒ»çš„ä¸­æœŸå¾…å€¤æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ")

# --- é ‚ã„ãŸå…¨ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ ã•ã›ãŸå®Œå…¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ---
data_db = {
    "ï¼¡": {
        "â‘¢": {"win": "7/17", "uren5": "11/17", "fuku": "15/23", "abc_w": "9/17(3)", "idx_r": ["8/20", "13", "3", "4"], "idx_w": "10(3)", "pop": [15,16,5,11,5,5,3,5,0,1,1,1,0,1]},
        "â‘£": {"win": "6/20", "uren5": "12/20", "fuku": "9/21", "abc_w": "7/20", "idx_r": ["9/20", "7", "10", "6"], "idx_w": "12(3)", "pop": [10,12,8,5,4,6,5,2,4,3,1,0,0,1]},
        "â‘¤": {"win": "3/9", "uren5": "8/9", "fuku": "4/12", "abc_w": "5/9", "idx_r": ["3/9", "3", "3", "2"], "idx_w": "3", "pop": [6,10,5,4,3,1,2,2,2]}
    },
    "ï¼¢": {
        "â‘¢": {"win": "3/6", "uren5": "5/6", "fuku": "4/8", "abc_w": "2/6", "idx_r": ["6/8", "5", "1", "2"], "idx_w": "6(1)", "pop": [6,2,4,2,3,1,3,1]},
        "â‘£": {"win": "10/19", "uren5": "9/19", "fuku": "8/20", "abc_w": "7/19", "idx_r": ["9/16", "8", "3", "4"], "idx_w": "8(2)", "pop": [11,12,7,4,1,5,6,1,3,1,4,2]},
        "â‘¤": {"win": "4/13", "uren5": "7/13", "fuku": "9/15", "abc_w": "7/13(2)", "idx_r": ["6/12", "2", "4", "3"], "idx_w": "5(1)", "pop": [10,11,3,6,5,3,0,4,1,0,0,0,1]}
    },
    "ï¼£": {
        "â‘¢": {"win": "6/9", "uren5": "6/9", "fuku": "8/10", "abc_w": "7/9(1)", "idx_r": ["2/5", "2", "2", "3"], "idx_w": "3(1)", "pop": [9,6,5,3,1,1,1,1,1,1,1]},
        "â‘£": {"win": "3/7", "uren5": "4/7", "fuku": "5/11", "abc_w": "3/7", "idx_r": ["2/10", "4", "4", "5"], "idx_w": "4(2)", "pop": [6,4,2,8,3,1,2,2,2,0,1,1]},
        "â‘¤": {"win": "4/6", "uren5": "4/6", "fuku": "4/8", "abc_w": "2/6", "idx_r": ["3/7", "3", "1", "1"], "idx_w": "2", "pop": [3,2,5,1,5,1,2,1,1,1,0,1]}
    },
    "ï¼¡ï¼¢": {
        "â‘¢": {"win": "9/13", "uren5": "12/13", "fuku": "14/17", "abc_w": "10/13(1)", "idx_r": ["13/14", "6", "2", "2"], "idx_w": "8(3)", "pop": [13,13,7,5,3,4,0,1,1,2,1,0,0,0,1]},
        "â‘£": {"win": "3/5", "uren5": "6/11", "fuku": "5/12", "abc_w": "6/11", "idx_r": ["5/12", "4", "5", "3"], "idx_w": "5(1)", "pop": [7,8,3,4,5,4,2,1,0,1,1]},
        "â‘¤": {"win": "1/3", "uren5": "4/4", "fuku": "3/4", "abc_w": "2/4", "idx_r": ["2/4", "3", "0", "0"], "idx_w": "2(1)", "pop": [3,1,4,1,2]}
    },
    "ï¼¡ï¼£": {
        "â‘¢": {"win": "4/13", "uren5": "2/5", "fuku": "5/8", "abc_w": "2/5", "idx_r": ["12/8", "0", "0", "2"], "idx_w": "5(2)", "pop": [6,4,3,2,3,2,1,0,2,0,0,0,0,1]},
        "â‘£": {"win": "3/5", "uren5": "7/7", "fuku": "5/8", "abc_w": "5/7", "idx_r": ["5/6", "2", "3", "1"], "idx_w": "5", "pop": [6,3,6,3,2,3,0,0,0,0,0,0,1]},
        "â‘¤": {"win": "5/7", "uren5": "0/1", "fuku": "1/1", "abc_w": "0/1", "idx_r": ["0/1", "2", "0", "0"], "idx_w": "1", "pop": [1,0,0,1,0,0,1]}
    },
    "ï¼¢ï¼£": {
        "â‘¢": {"win": "1/3", "uren5": "2/3", "fuku": "4/5", "abc_w": "2/3", "idx_r": ["4/5", "2", "2", "3"], "idx_w": "5(1)", "pop": [5,3,2,0,2,0,1,0,2]},
        "â‘£": {"win": "2/5", "uren5": "1/5", "fuku": "1/5", "abc_w": "0/5", "idx_r": ["1/5", "3", "2", "2"], "idx_w": "2(1)", "pop": [2,3,2,2,1,2,0,1,0,0,0,1]},
        "â‘¤": {"win": "2/5", "uren5": "4/5", "fuku": "5/6", "abc_w": "2/5", "idx_r": ["3/6", "3", "3", "0"], "idx_w": "2", "pop": [5,3,3,1,1,0,0,2,0,0,1,0,0,1]}
    },
    "ï¼¡ï¼¢ï¼£": {
        "â‘¢": {"win": "64/86", "uren5": "56/86", "fuku": "47/86", "abc_w": "5476äººæ°—(98)", "idx_r": ["3/8", "4", "4", "1"], "idx_w": "4", "pop": [0,0,0,0,0,0,0,0]},
        "â‘£": {"win": "0/0", "uren5": "0/0", "fuku": "0/0", "abc_w": "0/0", "idx_r": ["0/0", "0", "0", "0"], "idx_w": "0", "pop": [0,0,0,0,0,0,0,0]},
        "â‘¤": {"win": "0/0", "uren5": "0/0", "fuku": "0/0", "abc_w": "0/0", "idx_r": ["0/0", "0", "0", "0"], "idx_w": "0", "pop": [0,0,0,0,0,0,0,0]}
    },
    "ãƒãƒ¼ãƒãƒ¼ã‚¯": {
        "â‘¢": {"win": "10/27", "uren5": "12/27", "fuku": "7/27", "abc_w": "3/8", "idx_r": ["4/8", "2", "2", "1"], "idx_w": "3", "pop": [6,6,4,2,1,2,2,0,3,1,1,0,1]},
        "â‘£": {"win": "11/19", "uren5": "10/19", "fuku": "4/19", "abc_w": "4/8", "idx_r": ["2/8", "3", "2", "4"], "idx_w": "4", "pop": [11,10,4,4,4,4,8,3,1,2,0,1,2,2]},
        "â‘¤": {"win": "9/18", "uren5": "8/18", "fuku": "7/18", "abc_w": "3/10", "idx_r": ["2/10", "3", "4", "3"], "idx_w": "3", "pop": [9,8,7,7,6,3,4,3,1,3,1,0,0,1]}
    }
}

pt_p = {"ï¼¡":"20/33","ï¼¢":"19/25","ï¼£":"11/21","ï¼¡ï¼¢":"21/27","ï¼¡ï¼£":"11/14","ï¼¢ï¼£":"8/15","ï¼¡ï¼¢ï¼£":"7/6","ãƒãƒ¼ãƒãƒ¼ã‚¯":"14/20"}
pt_t = {"ï¼¡":"18/27","ï¼¢":"10/15","ï¼£":"6/15","ï¼¡ï¼¢":"18/23","ï¼¡ï¼£":"8/9","ï¼¢ï¼£":"6/11","ï¼¡ï¼¢ï¼£":"5/8","ãƒãƒ¼ãƒãƒ¼ã‚¯":"9/20"}
pt_pt = {"ï¼¡":"10/20","ï¼¢":"6/8","ï¼£":"4/7","ï¼¡ï¼¢":"13/14","ï¼¡ï¼£":"9/10","ï¼¢ï¼£":"1/6","ï¼¡ï¼¢ï¼£":"2/2","ãƒãƒ¼ãƒãƒ¼ã‚¯":"9/20"}
idx_w_tot = {"ï¼¡":"30","ï¼¢":"17","ï¼£":"7","ï¼¡ï¼¢":"18","ï¼¡ï¼£":"11","ï¼¢ï¼£":"9","ï¼¡ï¼¢ï¼£":"4","ãƒãƒ¼ãƒãƒ¼ã‚¯":"14"}
recent_idx = {"ï¼¡":"26/58","ï¼¢":"15/31","ï¼£":"11/20","ï¼¡ï¼¢":"28/37","ï¼¡ï¼£":"13/15","ï¼¢ï¼£":"14/20","ï¼¡ï¼¢ï¼£":"3/8","ãƒãƒ¼ãƒãƒ¼ã‚¯":"10/27"}

# ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
target = st.sidebar.selectbox("è»¸é¦¬ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ", list(data_db.keys()))
lv = st.sidebar.radio("ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠ", ["â‘¢", "â‘£", "â‘¤"])

st.header(f"ğŸ“ˆ {target} Ã— {lv} åˆ†æçµæœ")
d = data_db[target][lv]

def pct(frac):
    try:
        f = frac.split('(')[0]
        if '/' not in f: return f
        n, den = map(int, f.split('/'))
        return f"{(n/den)*100:.1f}%" if den != 0 else "0.0%"
    except: return "---"

# çš„ä¸­ç‡è¡¨ç¤º
st.subheader("ğŸ’¡ çš„ä¸­æœŸå¾…å€¤")
c1, c2, c3, c4 = st.columns(4)
with c1: st.metric("1ç€ç¢ºç‡", pct(d["win"]), d["win"])
with c2: st.metric("é¦¬é€£5äººå†…", pct(d["uren5"]), d["uren5"])
with c3: st.metric("è»¸é¦¬è¤‡å‹ç‡", pct(d["fuku"]), d["fuku"])
with c4: st.metric("ABCãƒ¯ã‚¤ãƒ‰çš„ä¸­ç‡", pct(d["abc_w"]), d["abc_w"])

st.divider()

# æŒ‡æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³
st.subheader(f"ğŸ¯ {target} ç‹¬è‡ªæŒ‡æ•°ãƒ»PTåˆ†æ (æœ€è¿‘)")
col_a, col_b, col_c = st.columns(3)
with col_a:
    st.write(f"ç‹¬è‡ªæŒ‡æ•°ãƒ¯ã‚¤ãƒ‰ç¢ºç‡: **{idx_w_tot.get(target)}**")
    st.write(f"æœ€è¿‘ã®æŒ‡æ•°çš„ä¸­: **{recent_idx.get(target)}**")
with col_b:
    st.write(f"PTæœ€è¿‘(P): **{pt_p.get(target)}**")
    st.write(f"PTæœ€è¿‘(T): **{pt_t.get(target)}**")
with col_c:
    st.write(f"PTæœ€è¿‘(PT): **{pt_pt.get(target)}**")

st.divider()

# ãƒ©ãƒ³ã‚­ãƒ³ã‚°åˆ¥æˆç¸¾
st.subheader(f"ğŸ“Š {lv} ç‹¬è‡ªæŒ‡æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°åˆ¥çš„ä¸­æ•°")
idx_cols = st.columns(5)
with idx_cols[0]: st.write(f"**1ä½**: {d['idx_r'][0]}")
with idx_cols[1]: st.write(f"**2ä½**: {d['idx_r'][1]}")
with idx_cols[2]: st.write(f"**3ä½**: {d['idx_r'][2]}")
with idx_cols[3]: st.write(f"**4ä½**: {d['idx_r'][3]}")
with idx_cols[4]: st.write(f"**ãƒ¯ã‚¤ãƒ‰**: {d['idx_w']}")

st.divider()

# äººæ°—åˆ†å¸ƒ
st.subheader(f"ğŸ“ˆ {target} Ã— {lv} éå»ã®äººæ°—åˆ†å¸ƒ")
pop_df = pd.DataFrame({"äººæ°—": [f"{i+1}äºº" for i in range(len(d['pop']))], "å›æ•°": d['pop']})
st.bar_chart(pop_df, x="äººæ°—", y="å›æ•°")
