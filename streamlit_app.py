import streamlit as st
import pandas as pd

st.set_page_config(page_title="„Éó„É≠Á´∂È¶¨‰∫àÊÉ≥Ë®àÁÆóÊ©ü„ÉªÊúÄÁµÇÁâà", layout="wide")
st.title("üèá Áã¨Ëá™„É≠„Ç∏„ÉÉ„ÇØ„ÉªÁöÑ‰∏≠ÊúüÂæÖÂÄ§ ÁöÑ‰∏≠Êï∞Ê§úÁ¥¢„Ç∑„Çπ„ÉÜ„É†")

data_db = {
    "Ôº°": {
        "‚ë¢": {"win": "7/17", "uren5": "11/17", "fuku": "15/23", "abc_w": "9/17(3)", "pop": [15,16,5,11,5,5,3,5,0,1,1,1,0,1], "idx": ["8/20", "13", "3", "4"], "idx_w": "10(3)"},
        "‚ë£": {"win": "6/20", "uren5": "12/20", "fuku": "9/21", "abc_w": "7/20", "pop": [10,12,8,5,4,6,5,2,4,3,1,0,0,1], "idx": ["9/20", "7", "10", "6"], "idx_w": "12(3)"},
        "‚ë§": {"win": "3/9", "uren5": "8/9", "fuku": "4/12", "abc_w": "5/9", "pop": [6,10,5,4,3,1,2,2], "idx": ["3/9", "3", "3", "2"], "idx_w": "3"}
    },
    "Ôº¢": {
        "‚ë¢": {"win": "3/6", "uren5": "5/6", "fuku": "4/8", "abc_w": "2/6", "pop": [6,2,4,2,3,1,3,1], "idx": ["6/8", "5", "1", "2"], "idx_w": "6(1)"},
        "‚ë£": {"win": "10/19", "uren5": "9/19", "fuku": "8/20", "abc_w": "7/19", "pop": [11,12,7,4,1,5,6,1,3,1,4,2], "idx": ["9/16", "8", "3", "4"], "idx_w": "8(2)"},
        "‚ë§": {"win": "4/13", "uren5": "7/13", "fuku": "9/15", "abc_w": "7/13(2)", "pop": [10,11,3,6,5,3,4,0,1,0,0,0,1], "idx": ["6/12", "2", "4", "3"], "idx_w": "5(1)"}
    },
    "Ôº£": {
        "‚ë¢": {"win": "6/9", "uren5": "6/9", "fuku": "8/10", "abc_w": "7/9(1)", "pop": [9,6,5,3,1,1,1,1], "idx": ["2/5", "2", "2", "3"], "idx_w": "3(1)"},
        "‚ë£": {"win": "3/7", "uren5": "4/7", "fuku": "5/11", "abc_w": "3/7", "pop": [6,4,2,8,3,1,2,2,2,0,1,1], "idx": ["2/10", "4", "4", "5"], "idx_w": "4(2)"},
        "‚ë§": {"win": "4/6", "uren5": "4/6", "fuku": "4/8", "abc_w": "2/6", "pop": [3,2,5,1,5,1,2,1], "idx": ["3/7", "3", "1", "1"], "idx_w": "2"}
    },
    "Ôº°Ôº¢": {
        "‚ë¢": {"win": "9/13", "uren5": "12/13", "fuku": "14/17", "abc_w": "10/13(1)", "pop": [13,13,7,5,3,4,0,1,1,2,1,0,0,0,1], "idx": ["13/14", "6", "2", "2"], "idx_w": "8(3)"},
        "‚ë£": {"win": "3/5", "uren5": "6/11", "fuku": "5/12", "abc_w": "6/11", "pop": [7,8,3,4,5,4,2,1,0,1,1], "idx": ["5/12", "4", "5", "3"], "idx_w": "5(1)"},
        "‚ë§": {"win": "1/3", "uren5": "4/4", "fuku": "3/4", "abc_w": "2/4", "pop": [3,1,4,1,2], "idx": ["2/4", "3", "0", "0"], "idx_w": "2(1)"}
    },
    "Ôº°Ôº£": {
        "‚ë¢": {"win": "4/13", "uren5": "2/5", "fuku": "5/8", "abc_w": "2/5", "pop": [6,4,3,2,3,2,1,0,2,0,0,0,0,1], "idx": ["12/8", "0", "0", "2"], "idx_w": "5(2)"},
        "‚ë£": {"win": "3/5", "uren5": "7/7", "fuku": "5/8", "abc_w": "5/7", "pop": [6,3,6,3,2,3,0,0,0,0,0,0,1], "idx": ["5/6", "2", "3", "1"], "idx_w": "5"},
        "‚ë§": {"win": "5/7", "uren5": "0/1", "fuku": "1/1", "abc_w": "0/1", "pop": [1,0,0,1,0,0,1], "idx": ["0/1", "2", "0", "0"], "idx_w": "1"}
    },
    "Ôº¢Ôº£": {
        "‚ë¢": {"win": "1/3", "uren5": "2/3", "fuku": "4/5", "abc_w": "2/3", "pop": [5,3,2,0,2,0,1,0,2], "idx": ["4/5", "2", "2", "3"], "idx_w": "5(1)"},
        "‚ë£": {"win": "2/5", "uren5": "1/5", "fuku": "1/5", "abc_w": "0/5", "pop": [2,3,2,2,1,2,0,1,0,0,0,1], "idx": ["1/5", "3", "2", "2"], "idx_w": "2(1)"},
        "‚ë§": {"win": "2/5", "uren5": "4/5", "fuku": "5/6", "abc_w": "2/5", "pop": [5,3,3,1,1,0,0,2,0,0,1,0,0,1], "idx": ["3/6", "3", "3", "0"], "idx_w": "2"}
    },
    "Ôº°Ôº¢Ôº£": {
        "‚ë¢": {"win": "64/86", "uren5": "56/86", "fuku": "47/86", "abc_w": "5476‰∫∫Ê∞ó(98)", "pop": [0,0,0,0,0,0,0,0], "idx": ["3/8", "4", "4", "1"], "idx_w": "4"},
        "‚ë£": {"win": "0/0", "uren5": "0/0", "fuku": "0/0", "abc_w": "0/0", "pop": [0,0,0,0,0,0,0,0], "idx": ["0/0", "0", "0", "0"], "idx_w": "0"},
        "‚ë§": {"win": "0/0", "uren5": "0/0", "fuku": "0/0", "abc_w": "0/0", "pop": [0,0,0,0,0,0,0,0], "idx": ["0/0", "0", "0", "0"], "idx_w": "0"}
    },
    "„Éé„Éº„Éû„Éº„ÇØ": {
        "‚ë¢": {"win": "10/27", "uren5": "12/27", "fuku": "7/27", "abc_w": "3/8", "pop": [6,6,4,2,1,2,2,0,3,1,1,0,1], "idx": ["4/8", "2", "2", "1"], "idx_w": "3"},
        "‚ë£": {"win": "11/19", "uren5": "10/19", "fuku": "4/19", "abc_w": "4/8", "pop": [11,10,4,4,4,4,8,3,1,2,0,1,2,2], "idx": ["2/8", "3", "2", "4"], "idx_w": "4"},
        "‚ë§": {"win": "9/18", "uren5": "8/18", "fuku": "7/18", "abc_w": "3/10", "pop": [9,8,7,7,6,3,4,3,1,3,1,0,0,1], "idx": ["2/10", "3", "4", "3"], "idx_w": "3"}
    }
}

pt_p = {"Ôº°":"20/33","Ôº¢":"19/25","Ôº£":"11/21","Ôº°Ôº¢":"21/27","Ôº°Ôº£":"11/14","Ôº¢Ôº£":"8/15","Ôº°Ôº¢Ôº£":"7/6","„Éé„Éº„Éû„Éº„ÇØ":"14/20"}
pt_t = {"Ôº°":"18/27","Ôº¢":"10/15","Ôº£":"6/15","Ôº°Ôº¢":"18/23","Ôº°Ôº£":"8/9","Ôº¢Ôº£":"6/11","Ôº°Ôº¢Ôº£":"5/8","„Éé„Éº„Éû„Éº„ÇØ":"9/20"}
pt_pt = {"Ôº°":"10/20","Ôº¢":"6/8","Ôº£":"4/7","Ôº°Ôº¢":"13/14","Ôº°Ôº£":"9/10","Ôº¢Ôº£":"1/6","Ôº°Ôº¢Ôº£":"2/2","„Éé„Éº„Éû„Éº„ÇØ":"9/20"}
idx_w_tot = {"Ôº°":"30","Ôº¢":"17","Ôº£":"7","Ôº°Ôº¢":"18","Ôº°Ôº£":"11","Ôº¢Ôº£":"9","Ôº°Ôº¢Ôº£":"4","„Éé„Éº„Éû„Éº„ÇØ":"14"}

st.sidebar.header("üîç „ÄêStep 1„Äë Êù°‰ª∂ÈÅ∏Êäû")
target = st.sidebar.selectbox("Ëª∏È¶¨„Çø„Ç§„Éó„ÇíÈÅ∏Êäû", list(data_db.keys()))
lv = st.sidebar.radio("„É¨„Éô„É´„ÇíÈÅ∏Êäû", ["‚ë¢", "‚ë£", "‚ë§"])

st.subheader("üìù „ÄêStep 2„Äë ‰ªäÊó•„ÅÆÊÉÖÂ†±„ÇíÂÖ•Âäõ")
col_in1, col_in2, col_in3 = st.columns(3)
with col_in1: horse_pop = st.number_input("‰ªäÊó•„ÅÆÈ¶¨„ÅÆ‰∫∫Ê∞ó(1„Äú15)", 1, 15, 1)
with col_in2: idx_rank = st.number_input("Áã¨Ëá™ÊåáÊï∞„ÅØ‰Ωï‰ΩçÔºü(1„Äú4)", 1, 4, 1)
with col_in3: p_val = st.number_input("P„ÅÆÂÄ§„ÅØÔºü(1„Äú50)", 1, 50, 5)

st.divider()

d = data_db[target][lv]
pop_hits = d["pop"][horse_pop-1] if horse_pop <= len(d["pop"]) else 0
idx_hit_rate = d["idx"][idx_rank-1]

def pct(frac):
    try:
        f = frac.split('(')[0]
        if '/' not in f: return f
        n, den = map(int, f.split('/'))
        return f"{(n/den)*100:.1f}%" if den != 0 else "0.0%"
    except: return "---"

st.header(f"üìä ‰∫àÊÉ≥ÁµêË´ñÔºö{target} √ó {lv}")
res_c1, res_c2 = st.columns(2)
with res_c1: st.info(f"**ÁöÑ‰∏≠Ê†πÊã†(‰∫∫Ê∞ó)**\n\n{horse_pop}Áï™‰∫∫Ê∞ó„ÅÆÈÅéÂéªÁöÑ‰∏≠Êï∞Ôºö\n\n# {pop_hits}Âõû")
with res_c2: st.success(f"**ÁöÑ‰∏≠Ê†πÊã†(Áã¨Ëá™ÊåáÊï∞)**\n\nÊåáÊï∞{idx_rank}‰Ωç„ÅÆÈÅéÂéªÂÆüÁ∏æÔºö\n\n# {idx_hit_rate}")

st.divider()
st.subheader("üìã Áµ±Ë®àË©≥Á¥∞ (%)")
c1, c2, c3, c4 = st.columns(4)
with c1: st.metric("1ÁùÄÁ¢∫Áéá", pct(d["win"]), d["win"])
with c2: st.metric("È¶¨ÈÄ£5‰∫∫ÂÜÖ", pct(d["uren5"]), d["uren5"])
with c3: st.metric("Ë§áÂãùÁéá", pct(d["fuku"]), d["fuku"])
with c4: st.metric("ABC„ÉØ„Ç§„Éâ", pct(d["abc_w"]), d["abc_w"])

st.divider()
st.write(f"ÊåáÊï∞„ÉØ„Ç§„Éâ: **{idx_w_tot.get(target)}** | PT(P): **{pt_p.get(target)}** | PT(T): **{pt_t.get(target)}** | PT(PT): **{pt_pt.get(target)}**")
