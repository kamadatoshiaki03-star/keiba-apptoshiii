import streamlit as st
import pandas as pd

st.set_page_config(page_title="æœ€å¼·ç«¶é¦¬äºˆæƒ³è¨ˆç®—æ©Ÿ", layout="wide")
st.title("ğŸ‡ ç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯ãƒ»å…¨é …ç›®å…¥åŠ› äºˆæƒ³ã‚·ã‚¹ãƒ†ãƒ ")

# --- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (é ‚ã„ãŸå…¨æ•°å€¤ã‚’100%åæ˜ ) ---
data_db = {
    "ï¼¡": {"â‘¢":{"win":"7/17","uren5":"11/17","fuku":"15/23","abc_w":"9/17(3)","pop":[15,16,5,11,5,5,3,5,0,1,1,1,0,1],"idx":["8/20","13","3","4"],"idx_w":"10(3)"},"â‘£":{"win":"6/20","uren5":"12/20","fuku":"9/21","abc_w":"7/20","pop":[10,12,8,5,4,6,5,2,4,3,1,0,0,1],"idx":["9/20","7","10","6"],"idx_w":"12(3)"},"â‘¤":{"win":"3/9","uren5":"8/9","fuku":"4/12","abc_w":"5/9","pop":[6,10,5,4,3,1,2,2],"idx":["3/9","3","3","2"],"idx_w":"3"}},
    "ï¼¢": {"â‘¢":{"win":"3/6","uren5":"5/6","fuku":"4/8","abc_w":"2/6","pop":[6,2,4,2,3,1,3,1],"idx":["6/8","5","1","2"],"idx_w":"6(1)"},"â‘£":{"win":"10/19","uren5":"9/19","fuku":"8/20","abc_w":"7/19","pop":[11,12,7,4,1,5,6,1,3,1,4,2],"idx":["9/16","8","3","4"],"idx_w":"8(2)"},"â‘¤":{"win":"4/13","uren5":"7/13","fuku":"9/15","abc_w":"7/13(2)","pop":[10,11,3,6,5,3,0,4,1,0,0,0,1],"idx":["6/12","2","4","3"],"idx_w":"5(1)"}},
    "ï¼£": {"â‘¢":{"win":"6/9","uren5":"6/9","fuku":"8/10","abc_w":"7/9(1)","pop":[9,6,5,3,1,1,1,1,1,1,1],"idx":["2/5","2","2","3"],"idx_w":"3(1)"},"â‘£":{"win":"3/7","uren5":"4/7","fuku":"5/11","abc_w":"3/7","pop":[6,4,2,8,3,1,2,2,2,0,1,1],"idx":["2/10","4","4","5"],"idx_w":"4(2)"},"â‘¤":{"win":"4/6","uren5":"4/6","fuku":"4/8","abc_w":"2/6","pop":[3,2,5,1,5,1,2,1,1,1,0,1],"idx":["3/7","3","1","1"],"idx_w":"2"}},
    "ï¼¡ï¼¢": {"â‘¢":{"win":"9/13","uren5":"12/13","fuku":"14/17","abc_w":"10/13(1)","pop":[13,13,7,5,3,4,0,1,1,2,1,0,0,0,1],"idx":["13/14","6","2","2"],"idx_w":"8(3)"},"â‘£":{"win":"3/5","uren5":"6/11","fuku":"5/12","abc_w":"6/11","pop":[7,8,3,4,5,4,2,1,0,1,1],"idx":["5/12","4","5","3"],"idx_w":"5(1)"},"â‘¤":{"win":"1/3","uren5":"4/4","fuku":"3/4","abc_w":"2/4","pop":[3,1,4,1,2,0,0,0],"idx":["2/4","3","0","0"],"idx_w":"2(1)"}}
}

st.sidebar.header("ğŸ“‹ 1. ãƒ¬ãƒ¼ã‚¹å…¨ä½“æ¡ä»¶")
target = st.sidebar.selectbox("è»¸é¦¬ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ", list(data_db.keys()))
lv = st.sidebar.radio("ãƒ¬ãƒ™ãƒ«", ["â‘¢", "â‘£", "â‘¤"])

st.header("ğŸ“ 2. ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã‚’å…¥åŠ›")

st.subheader("ã€ï¼¡ï¼¢ï¼£å„é¦¬ï¼šé¦¬ç•ªã¨äººæ°—ã€‘")
col_a, col_b, col_c = st.columns(3)
with col_a:
    num_a = st.text_input("ï¼¡é¦¬(ç•ª)", "5")
    pop_a = st.number_input("ï¼¡äººæ°—", 1, 15, 5)
with col_b:
    num_b = st.text_input("ï¼¢é¦¬(ç•ª)", "6")
    pop_b = st.number_input("ï¼¢äººæ°—", 1, 15, 6)
with col_c:
    num_c = st.text_input("ï¼£é¦¬(ç•ª)", "1")
    pop_c = st.number_input("ï¼£äººæ°—", 1, 15, 1)

st.divider()

st.subheader("ã€ç‹¬è‡ªæŒ‡æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼šé¦¬ç•ªã€‘")
i1, i2, i3, i4 = st.columns(4)
idx1 = i1.text_input("æŒ‡æ•°1ä½(ç•ª)", "5")
idx2 = i2.text_input("æŒ‡æ•°2ä½(ç•ª)", "8")
idx3 = i3.text_input("æŒ‡æ•°3ä½(ç•ª)", "2")
idx4 = i4.text_input("æŒ‡æ•°4ä½(ç•ª)", "1")

st.divider()

st.subheader("ã€ï¼°ãƒ»ï¼´ãƒ»ï¼°ï¼´ï¼šé¦¬ç•ªã€‘")
st.write("â€»è¤‡æ•°ã„ã‚‹å ´åˆã¯ã€Œ8, 5ã€ã®ã‚ˆã†ã«ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦ãã ã•ã„")
col_p, col_t, col_pt = st.columns(3)
p_val = col_p.text_input("ï¼°é¦¬(ç•ª)", "8, 5")
t_val = col_t.text_input("ï¼´é¦¬(ç•ª)", "5")
pt_val = col_pt.text_input("ï¼°ï¼´é¦¬(ç•ª)", "8")

# --- åˆ†æçµæœè¡¨ç¤º ---
d = data_db[target][lv]
st.divider()
st.header(f"ğŸ“Š äºˆæƒ³ã®çµè«–ï¼š{target} Ã— {lv}")

hit_a = d["pop"][pop_a-1] if pop_a <= len(d["pop"]) else 0
st.info(f"ğŸ’¡ **è»¸é¦¬(é¦¬ç•ª{num_a})ã®çš„ä¸­æ ¹æ‹ **: åŒæ¡ä»¶ã§ **{pop_a}ç•ªäººæ°—** ãŒæ¥ãŸéå»å›æ•°ã¯ **{hit_a}å›** ã§ã™ã€‚")

res_col1, res_col2 = st.columns(2)
with res_col1:
    st.success(f"ğŸ¯ **æŒ‡æ•°1ä½(é¦¬ç•ª{idx1})ã®çš„ä¸­å®Ÿç¸¾**\n\n## {d['idx'][0]}")
with res_col2:
    idx_w_val = {"ï¼¡":"30","ï¼¢":"17","ï¼£":"7","ï¼¡ï¼¢":"18"}.get(target, "---")
    st.warning(f"ğŸ“ˆ **ç‹¬è‡ªæŒ‡æ•°ãƒ¯ã‚¤ãƒ‰ç¢ºç‡**\n\n## {idx_w_val}")

st.divider()
st.subheader("ğŸ“‹ çš„ä¸­æœŸå¾…å€¤(ï¼…)")
def pct(frac):
    try:
        f = frac.split('(')[0]
        if '/' not in f: return f
        n, den = map(int, f.split('/'))
        return f"{(n/den)*100:.1f}%" if den != 0 else "0%"
    except: return "---"

c1, c2, c3, c4 = st.columns(4)
with c1: st.metric("1ç€ç¢ºç‡", pct(d["win"]), d["win"])
with c2: st.metric("é¦¬é€£5å†…", pct(d["uren5"]), d["uren5"])
with c3: st.metric("è¤‡å‹ç‡", pct(d["fuku"]), d["fuku"])
with c4: st.metric("ABCãƒ¯ã‚¤ãƒ‰", pct(d["abc_w"]), d["abc_w"])
