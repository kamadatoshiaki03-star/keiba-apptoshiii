import streamlit as st
import pandas as pd

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="ãƒ—ãƒ­ç«¶é¦¬äºˆæƒ³è¨ˆç®—æ©Ÿãƒ»æœ€çµ‚å®Œæˆç‰ˆ", layout="wide")
st.title("ğŸ‡ ç‹¬è‡ªãƒ­ã‚¸ãƒƒã‚¯ãƒ»çš„ä¸­æ•°æ¤œç´¢ã‚·ã‚¹ãƒ†ãƒ ")

# --- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (é ‚ã„ãŸå…¨ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ ) ---
data_db = {
    "ï¼¡": {
        "â‘¢": {"win": "7/17", "uren5": "11/17", "fuku": "15/23", "abc_w": "9/17(3)", "pop": [15,16,5,11,5,5,3,5,0,1], "idx": ["8/20", "13", "3", "4"], "idx_w": "10(3)"},
        "â‘£": {"win": "6/20", "uren5": "12/20", "fuku": "9/21", "abc_w": "7/20", "pop": [10,12,8,5,4,6,5,2,4,3], "idx": ["9/20", "7", "10", "6"], "idx_w": "12(3)"},
        "â‘¤": {"win": "3/9", "uren5": "8/9", "fuku": "4/12", "abc_w": "5/9", "pop": [6,10,5,4,3,1,2,2,2,0], "idx": ["3/9", "3", "3", "2"], "idx_w": "3"}
    },
    "ï¼¢": {
        "â‘¢": {"win": "3/6", "uren5": "5/6", "fuku": "4/8", "abc_w": "2/6", "pop": [6,2,4,2,3,1,3,1,0,0], "idx": ["6/8", "5", "1", "2"], "idx_w": "6(1)"},
        "â‘£": {"win": "10/19", "uren5": "9/19", "fuku": "8/20", "abc_w": "7/19", "pop": [11,12,7,4,1,5,6,1,3,1], "idx": ["9/16", "8", "3", "4"], "idx_w": "8(2)"},
        "â‘¤": {"win": "4/13", "uren5": "7/13", "fuku": "9/15", "abc_w": "7/13(2)", "pop": [10,11,3,6,5,3,0,4,1,0], "idx": ["6/12", "2", "4", "3"], "idx_w": "5(1)"}
    },
    "ï¼£": {
        "â‘¢": {"win": "6/9", "uren5": "6/9", "fuku": "8/10", "abc_w": "7/9(1)", "pop": [9,6,5,3,1,1,1,1,1,1], "idx": ["2/5", "2", "2", "3"], "idx_w": "3(1)"},
        "â‘£": {"win": "3/7", "uren5": "4/7", "fuku": "5/11", "abc_w": "3/7", "pop": [6,4,2,8,3,1,2,2,2,0], "idx": ["2/10", "4", "4", "5"], "idx_w": "4(2)"},
        "â‘¤": {"win": "4/6", "uren5": "4/6", "fuku": "4/8", "abc_w": "2/6", "pop": [3,2,5,1,5,1,2,1,1,1], "idx": ["3/7", "3", "1", "1"], "idx_w": "2"}
    },
    "ï¼¡ï¼¢": {
        "â‘¢": {"win": "9/13", "uren5": "12/13", "fuku": "14/17", "abc_w": "10/13(1)", "pop": [13,13,7,5,3,4,0,1,1,2], "idx": ["13/14", "6", "2", "2"], "idx_w": "8(3)"},
        "â‘£": {"win": "3/5", "uren5": "6/11", "fuku": "5/12", "abc_w": "6/11", "pop": [7,8,3,4,5,4,2,1,0,1], "idx": ["5/12", "4", "5", "3"], "idx_w": "5(1)"},
        "â‘¤": {"win": "1/3", "uren5": "4/4", "fuku": "3/4", "abc_w": "2/4", "pop": [3,1,4,1,2,0,0,0,0,0], "idx": ["2/4", "3", "0", "0"], "idx_w": "2(1)"}
    }
}

# ã‚µã‚¤ãƒ‰ãƒãƒ¼è¨­å®š
st.sidebar.header("ğŸ“‹ ã€Step 1ã€‘ æ¡ä»¶é¸æŠ")
target = st.sidebar.selectbox("è»¸ã‚¿ã‚¤ãƒ—", list(data_db.keys()))
lv = st.sidebar.radio("ãƒ¬ãƒ™ãƒ«", ["â‘¢", "â‘£", "â‘¤"])

# ãƒ¡ã‚¤ãƒ³è¡¨ç¤º
st.header(f"ğŸ“ˆ äºˆæƒ³ï¼š{target} Ã— {lv}")
d = data_db[target][lv]

# --- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼šäººæ°—ã®æ¨ªã«é¦¬ç•ª ---
st.subheader("ğŸ“ ã€Step 2ã€‘ ä»Šæ—¥ã®äººæ°—é †ã«ã€é¦¬ç•ªã€ã‚’å…¥åŠ›")
st.write("â€»å…¥åŠ›ã™ã‚‹ã¨ã€ãã®äººæ°—ãŒéå»ã«çš„ä¸­ã—ãŸå›æ•°ãŒæ¨ªã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚")

pop_labels = [1, 2, 3, 4, 5, 6, 7, 8, 10]
col1, col2, col3 = st.columns(3)

for i, p in enumerate(pop_labels):
    idx_in_data = p - 1
    past_hits = d["pop"][idx_in_data] if idx_in_data < len(d["pop"]) else 0
    
    # 3åˆ—ã«åˆ†ã‘ã¦è¡¨ç¤º
    target_col = col1 if i % 3 == 0 else col2 if i % 3 == 1 else col3
    target_col.text_input(f"{p}ç•ªäººæ°— (çš„ä¸­:{past_hits}å›) ã®é¦¬ç•ª", key=f"p{p}")

st.divider()

# --- ç‹¬è‡ªæŒ‡æ•°ãƒ©ãƒ³ã‚¯ ---
st.subheader("ğŸ¯ ç‹¬è‡ªæŒ‡æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°")
idx_cols = st.columns(5)
for i in range(4):
    idx_cols[i].text_input(f"æŒ‡æ•°{i+1}ä½ (çš„ä¸­:{d['idx'][i]}) ã®é¦¬ç•ª", key=f"idx{i}")
idx_cols[4].write(f"ãƒ¯ã‚¤ãƒ‰å®Ÿç¸¾:\n\n**{d['idx_w']}**")

st.divider()

# --- PTã‚»ã‚¯ã‚·ãƒ§ãƒ³ ---
st.subheader("ğŸ ï¼°ãƒ»ï¼´ãƒ»ï¼°ï¼´é¦¬ (é¦¬ç•ª)")
pt_p = {"ï¼¡":"20/33","ï¼¢":"19/25","ï¼£":"11/21","ï¼¡ï¼¢":"21/27"}.get(target,"---")
pt_t = {"ï¼¡":"18/27","ï¼¢":"10/15","ï¼£":"6/15","ï¼¡ï¼¢":"18/23"}.get(target,"---")

c_p, c_t, c_pt = st.columns(3)
c_p.text_input(f"ï¼°é¦¬ (å®Ÿç¸¾:{pt_p}) ã®é¦¬ç•ª", key="p_m")
c_t.text_input(f"ï¼´é¦¬ (å®Ÿç¸¾:{pt_t}) ã®é¦¬ç•ª", key="t_m")
c_pt.text_input("ï¼°ï¼´é¦¬ ã®é¦¬ç•ª", key="pt_m")

st.divider()

# --- åŸºæœ¬æœŸå¾…å€¤ ---
st.subheader("ğŸ“Š ã“ã®æ¡ä»¶ã®åŸºæœ¬æœŸå¾…å€¤")
def pct(frac):
    try:
        f = frac.split('(')[0]
        n, den = map(int, f.split('/'))
        return f"{(n/den)*100:.1f}%" if den != 0 else "0%"
    except: return "---"

cc1, cc2, cc3, cc4 = st.columns(4)
cc1.metric("è»¸1ç€ç‡", pct(d["win"]), d["win"])
cc2.metric("é¦¬é€£5å†…", pct(d["uren5"]), d["uren5"])
cc3.metric("è¤‡å‹ç‡", pct(d["fuku"]), d["fuku"])
cc4.metric("ABCãƒ¯ã‚¤ãƒ‰", pct(d["abc_w"]), d["abc_w"])
